<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HTML5 Moving Train</title>
<style>
  :root {
    --ui-bg: #0b1220;
    --panel: rgba(255,255,255,0.06);
    --accent: #ffcc33;
  }
  html,body { height:100%; margin:0; background:linear-gradient(#bfe9ff,#e6f7ff); font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:#062; }
  .wrap { display:flex; flex-direction:column; height:100vh; gap:8px; padding:12px; box-sizing:border-box; }
  header { display:flex; align-items:center; gap:12px; }
  h1 { font-size:18px; margin:0; color:#0b2540; }
  .controls { margin-left:auto; display:flex; align-items:center; gap:10px; background:var(--panel); padding:8px 10px; border-radius:10px; }
  label { font-size:13px; color:#073045; }
  input[type="range"] { width:160px; }
  button { background:#063b72; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
  button:active{ transform:translateY(1px) }
  canvas { width:100%; height:calc(100vh - 84px); border-radius:10px; box-shadow:0 8px 24px rgba(10,30,60,0.12); background:linear-gradient(#cfeeff,#eaf9ff); display:block; }
  footer { font-size:12px; color:#0b2540; opacity:0.85; padding-left:4px;}
  .meta { font-size:12px; color:#073045; opacity:0.9; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>HTML5 Moving Train â€” canvas + requestAnimationFrame</h1>
    <div class="controls"><button onclick="document.getElementById('trainAudio').play()">Play Train Sounds</button>
      <button id="toggle">Pause</button>
      <label class="meta">Speed <input id="speed" type="range" min="0" max="4" step="0.01" value="1"></label>
      <label class="meta">Scale
        <input id="scale" type="range" min="0.5" max="1.6" step="0.01" value="1">
      </label>
    </div>
  </header>

  <canvas id="c"></canvas>

  <footer>Use the slider to change speed and scale. The train loops across the canvas.<br>
    <a href="https://freesound.org/people/LS/sounds/8550/">train.wav</a> by <a href="https://freesound.org/people/LS/">LS</a> | License: <a href="http://creativecommons.org/licenses/by/3.0/">Attribution 3.0</a></footer>
</div>

<script>
(() => {
  // Canvas setup (handle devicePixelRatio for crisp rendering)
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', { alpha: false });

  function resize() {
    const ratio = window.devicePixelRatio || 1;
    canvas.style.height = (window.innerHeight - 84) + 'px';
    canvas.width = Math.floor(canvas.clientWidth * ratio);
    canvas.height = Math.floor(canvas.clientHeight * ratio);
    ctx.setTransform(ratio,0,0,ratio,0,0);
  }
  window.addEventListener('resize', resize, { passive:true });
  resize();

  // Controls
  const speedInput = document.getElementById('speed');
  const toggleBtn = document.getElementById('toggle');
  const scaleInput = document.getElementById('scale');

  let running = true;
  toggleBtn.addEventListener('click', () => {
    running = !running;
    toggleBtn.textContent = running ? 'Pause' : 'Play';
    if(running) { lastTime = performance.now(); requestAnimationFrame(loop); }
  });

  // Scene state
  let trainX = -300;           // train offset (in px)
  let baseSpeed = 120;        // pixels per second at speed=1
  let lastTime = performance.now();
  let wheelAngle = 0;

  // Helper: draw gradient sky and background elements
  function drawBackground(w, h, t) {
    // Sky gradient
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0, '#bfe9ff');
    g.addColorStop(0.6, '#e6f7ff');
    g.addColorStop(1, '#d7eefc');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);

    // Sun (parallax slowly moving)
    const sunX = (w * 0.15) + Math.sin(t*0.0005) * 40;
    const sunY = h * 0.18;
    const sunR = Math.min(w,h) * 0.06;
    const sg = ctx.createRadialGradient(sunX, sunY, sunR*0.1, sunX, sunY, sunR);
    sg.addColorStop(0, '#fff3c8');
    sg.addColorStop(1, '#ffd66a00');
    ctx.fillStyle = sg;
    ctx.beginPath();
    ctx.arc(sunX, sunY, sunR, 0, Math.PI*2);
    ctx.fill();

    // Distant hills (two layers, parallax)
    ctx.save();
    ctx.translate(-((t*0.02)%w), 0);
    drawHills(w*2, h, 0.5, h*0.55, '#85c07a', '#5fa05f');
    ctx.restore();

    ctx.save();
    ctx.translate(-((t*0.04)%w), 0);
    drawHills(w*2, h, 0.3, h*0.7, '#b8e0a7', '#98cf8a');
    ctx.restore();

    // Track (foreground)
    ctx.fillStyle = '#553e2b';
    const trackY = h * 0.78;
    ctx.fillRect(0, trackY, w, h - trackY);

    // Rails
    ctx.strokeStyle = '#bba891';
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(0, trackY + 12);
    ctx.lineTo(w, trackY + 12);
    ctx.moveTo(0, trackY + 34);
    ctx.lineTo(w, trackY + 34);
    ctx.stroke();

    // Sleepers
    ctx.fillStyle = '#604233';
    const sleeperW = 48;
    for (let i = 0; i < w / sleeperW + 10; i++) {
      const sx = (i * sleeperW) + (t*0.5 % sleeperW) - sleeperW*2;
      ctx.fillRect(sx, trackY + 8, sleeperW*0.7, 10);
    }
  }

  function drawHills(w, h, heightFactor, yBase, colorA, colorB) {
    const grad = ctx.createLinearGradient(0, yBase - h*heightFactor, 0, yBase + 40);
    grad.addColorStop(0, colorA);
    grad.addColorStop(1, colorB);
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.moveTo(0, h);
    const bumps = 6;
    for (let i = 0; i <= bumps; i++) {
      const px = (i / bumps) * w;
      const py = yBase - Math.sin(i * 1.2) * (h*0.08) - (heightFactor*h*0.5);
      ctx.quadraticCurveTo(px - (w/bumps)/2, py + 40, px, h);
    }
    ctx.closePath();
    ctx.fill();
  }

  // Draw a stylized train (locomotive + cars). x,y is the left-bottom coordinate of the locomotive.
  function drawTrain(ctx, x, y, scale, wheelRotation) {
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(scale, scale);

    // Helper to draw wheel (so we can rotate)
    function wheel(cx, cy, r) {
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(wheelRotation);
      // Wheel rim
      ctx.beginPath();
      ctx.fillStyle = '#1f1f1f';
      ctx.arc(0,0,r,0,Math.PI*2);
      ctx.fill();
      // hub
      ctx.beginPath();
      ctx.fillStyle = '#6f6f6f';
      ctx.arc(0,0,r*0.35,0,Math.PI*2);
      ctx.fill();
      // spokes
      ctx.strokeStyle = '#bbb';
      ctx.lineWidth = 2;
      for (let i=0;i<6;i++){
        ctx.beginPath();
        ctx.rotate(Math.PI*2/6);
        ctx.moveTo(0,0);
        ctx.lineTo(r*0.9,0);
        ctx.stroke();
      }
      ctx.restore();
    }

    // Draw locomotive body
    ctx.fillStyle = '#d43b3b';
    ctx.strokeStyle = '#00000066';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.rect(0, -60, 180, 60);
    ctx.fill();
    ctx.stroke();

    // Cabin
    ctx.fillStyle = '#b02b2b';
    ctx.beginPath();
    ctx.rect(120, -100, 60, 40);
    ctx.fill();
    ctx.stroke();

    // Chimney
    ctx.fillStyle = '#333';
    ctx.beginPath();
    ctx.rect(24, -98, 20, 38);
    ctx.fill();
    ctx.stroke();

    // Roof highlight
    ctx.fillStyle = 'rgba(255,255,255,0.08)';
    ctx.fillRect(8, -96, 164, 12);

    // Window
    ctx.fillStyle = '#e6ffff';
    ctx.fillRect(128, -92, 36, 28);
    ctx.strokeRect(128, -92, 36, 28);

    // Headlight
    ctx.beginPath();
    ctx.fillStyle = '#fffbd0';
    ctx.arc(6, -30, 10, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    // Wheels: locomotive has three
    wheel(36, 4, 22);
    wheel(96, 4, 22);
    wheel(156, 4, 22);

    // Draw coal/carriage connectors and two passenger cars behind
    const carSpacing = 200;
    for (let c=1;c<=2;c++) {
      const ox = 180 + c*carSpacing - 10;
      // car body
      ctx.fillStyle = c%2 === 1 ? '#3b82d4' : '#2a9d8f';
      ctx.fillRect(ox, -50, 160, 50);
      ctx.strokeRect(ox, -50, 160, 50);

      // windows
      for (let widx=0; widx<3; widx++){
        ctx.fillStyle = '#e9ffff';
        ctx.fillRect(ox + 18 + widx*44, -40, 34, 28);
        ctx.strokeRect(ox + 18 + widx*44, -40, 34, 28);
      }

      // wheels for car
      wheel(ox + 36, 4, 18);
      wheel(ox + 120, 4, 18);
      // small connector line
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(ox - 12, -20);
      ctx.lineTo(ox - 2, -20);
      ctx.stroke();
    }

    ctx.restore();
  }

  // Animation loop
  function loop(now) {
    if (!running) return;
    const dt = Math.min(60, now - lastTime) / 1000; // clamp dt
    lastTime = now;

    const w = canvas.clientWidth;
    const h = canvas.clientHeight;
    // compute speed factoring control
    const speedFactor = parseFloat(speedInput.value); // 0..4
    const scale = parseFloat(scaleInput.value) || 1;

    const pxPerSec = baseSpeed * speedFactor;
    trainX += pxPerSec * dt;

    // wheel rotation depends on traveled distance; smaller scale => smaller wheel apparent radius => adjust rotation visually
    const effectiveWheelRadius = 22 * scale;
    wheelAngle += (pxPerSec * dt) / (effectiveWheelRadius) * 0.35; // tune rotation

    // Clear and draw
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBackground(w, h, now);

    // Determine y (ground) and scaled train position
    const groundY = h * 0.78;
    // Loop the train: when train's left is beyond width + margin, move back to negative margin
    const loopWidth = w + 700;
    if (trainX > loopWidth) trainX = -700;

    // Parallax: foreground larger; compute offset so train moves across with perspective
    const trainDrawX = trainX * 1.0; // could add parallax factor if wanted
    drawTrain(ctx, trainDrawX, groundY - 4, scale, wheelAngle);

    requestAnimationFrame(loop);
  }

  // Start
  lastTime = performance.now();
  requestAnimationFrame(loop);

  // small keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    if (e.key === ' ') { e.preventDefault(); toggleBtn.click(); }
    if (e.key === 'ArrowUp') speedInput.value = Math.min(4, Number(speedInput.value) + 0.1);
    if (e.key === 'ArrowDown') speedInput.value = Math.max(0, Number(speedInput.value) - 0.1);
  });

})();
</script>
    <audio id="trainAudio" loop autoplay>
  <source src="train.mp3" type="audio/mpeg">
  <source src="train.ogg" type="audio/ogg">
<source src="train.wav" type="audio/wav">
</audio>

</script>
</body>
</html>